---
layout: post
title: O(N)で1～Nの逆元を列挙する（法は大きい素数）
date: 2023-04-01 18:42 +0900
category: cp
slug: cp-3
---

$p$を十分大きい素数とする．以下では合同式の法を$p$とする．

法$p$に関する正整数$a$の逆元$a^{-1}$について，$p=qa+r \, (0\leq r < a)$として，

$$
    \tag{1}a^{-1} \equiv - qr^{-1}
$$

ここで，$a > r$である．よって，$1$から$N$までの整数について順に逆元を計算して配列に記録することにより，計算量$O(N)$で全ての逆元を求めることができる．

<br>

## (1)の導出

$$
    a a^{-1} \equiv 1 \iff a a^{-1} + py \equiv 1
$$

より，方程式$ax+py=1$の整数解$x=s$について，$s \equiv a^{-1}$である．以下ではこの整数解$x=s$を求める．

拡張ユークリッドの互除法を用いるが，元の式に少々変形を加える．$p=qa+r \, (0 \leq r < a)$として．

$$
    \begin{align}
        & ax+py = 1 \\
        &\iff qax+qpy = q \\
        &\iff (p-r)x+qpy = q \\
        &\iff rx+p(-x-qy) = -q \\
        &\tag{2}\iff rx+pz = -q
    \end{align}
$$

最終行で$z = -x-qy$とおいた．

方程式$rx'+pz'=1$の整数解を$x'=t$とすると
 - (2)の整数解は$x=-qt$である．
 - 冒頭に述べたものと同じ議論により，$t \equiv r^{-1}$である．

したがって整数解の1つは$x=-qr^{-1}$であり，$a^{-1} \equiv -qr^{-1}$である．

<br>

## 補足：1つの整数の逆元
ある1つの整数$a$の逆元は以下のどちらかにより$O(\log{p})$で計算できる．
 - 拡張ユークリッドの互除法により，$ax+py=1$の解$x \, (\textrm{mod} \, p)$を求める．
 - フェルマーの小定理より，$a\cdot a^{p-2} \equiv 1$である．$a^{p-2}$を繰り返し二乗法により計算する．